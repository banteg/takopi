name: CI

on:
  push:
    branches:
      - "master"
    tags-ignore:
      - "v*"
  pull_request:

concurrency:
  group: ci-${{ github.ref }}
  cancel-in-progress: true

jobs:
  checks:
    name: ${{ matrix.task }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        task: [format, ruff, ty, pytest]

    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Install uv
        uses: astral-sh/setup-uv@v7
        with:
          python-version: "3.14"
          enable-cache: true

      - name: Install dependencies
        run: uv sync

      - name: Run check
        shell: bash
        run: |
          case "${{ matrix.task }}" in
            format) uv run ruff format --check ;;
            ruff) uv run ruff check . ;;
            ty) uv run ty check . ;;
            pytest) uv run pytest ;;
          esac
